# 技术
## 验证码
- 导入jar包
- 编写Kaptcha配置类
对外方法
- 生成随机字符         String text = kaptchaProducer.createText();

- 生成输入字符的图片   BufferedImage image = kaptchaProducer.createImage(text);

## 会话管理
### 项目如何保存的登录状态？
- 验证登录状态
    - 登录时，服务器会把logintikect保存在cookies中返回给客户端
    - 使用interceptor拦截客户端所有请求，判断发过来的cookies里面有没有ticket，如果有，且未过期并有效，保存登录状态。
- 使用拦截器处理所有请求，实现登录状态保存。
    - 进入Controller前
        - 使用ThreadLocal保存User对象作为登录状态。(可以通过User对象访问到用户的各项信息)
    - Controller解析处理器返回视图前
        - 将登录用户LoginUser 解析到所有请求最终返回的页面。
    - 视图解析结束，请求结束前
        - 每次请求结束时，将线程池清空，也就是删除用户登录状态。

# 项目

## 设计思路(怎么实现的)

用户登录成功后，要保存用户状态，就添加了登录凭证数据库表，登录时，对比登录凭证，如何登录成功，保存用户状态在ThreadLocal中，比如(购物车之类的)，以便后面的连接中使用。
因为要记录浏览器访问状态，所以选择使用cookies保存服务器发给的ticket随机字符串，在之后每次访问制定的目录时，都携带该cookie，从而实现有状态的访问

## 功能
- 验证码，异步请求方式
- 登录验证
- 生成登录凭证，发送给客户端

三次请求

## 实体类
创建LoginTicket实体类，与数据库字段对应


## 跳转登录页面     /login   Get
### 
简单的处理请求页面转发

## 登录页面登录     /login Post 参数需要携带用户名、密码、验证码、记住我、session，response、kaptchaOwner
验证账号  密码  验证码
成功后   生成  登录凭证，发送给客户端

### C
- 接受参数
- 验证验证码正确性
- 调用Service层的登陆方法，接受返回的消息(map)
- 根据成功或者失败渲染到不同界面
    - 失败到登录
    - 成功到首页

### S
- 验证
    - 验证用户、密码、验证码是否为未输入
    - 验证用户是否存在
    - 判断账号是否激活
    - 验证密码是否是与数据库一致
- 登录
    - 成功后生成并返回登录凭证(创建LoginTicket对象，返回ticket)(因为记住密码，所以要设置过期时间)
- 返回Controller层消息
    - 将上述的成功或者失败的消息封装到map中返回

### D
创建LoginTicket对应的crud 
- 更新ticket是否过期方法
- 增加ticket方法
- 根据ticket查询整个ticket记录方法。


## 验证码生成       /kaptcha Get   异步请求方式


## 逻辑（异步请求方式）
### 功能
通过AJAX异步请求方式，用户点击刷新验证码就会发出get请求，请求会返回一个新的验证码。

### Controller逻辑
需要给浏览器返回验证码
服务器需要保存验证码，在浏览器携带验证码发起登陆请求时，进行验证，由于这是隐私信息，而且跨请求，所以放在session中。

### 优化(放在redis中)

- 使用set数据结构存储
- 生成随机数生成key
- 给客户端添加这个随机数位value的cookies
- 使用这个key将验证码数字形式保存在redis内存中
    - 客户端每次登录时，服务器就可以比对它的cookies中的这个随机数，得到redis中存储的验证码，与用户输入的验证码进行比对。


## 面试问题
### 有哪些功能？
用户输入用户名、密码、验证码后，会对验证码、用户名，密码进行验证，验证成功后，给浏览器返回一个登录凭证（保存在cookies里），刚开始使用的mysql保存登录凭证，后面使用redis保存登录凭证对象来优化性能。
然后实现了会话保持功能。
然后验证码刷新使用了异步请求的方式，可以不用刷新页面。

### 怎么实现保存用户登录状态的。
保存在ThreadLocal中
因为每一个客户端访问服务器都是单独一个线程，所以可以保证安全性。

具体是通过拦截器，Controller层处理前判断请求的cookies中是否带有登录凭证。如果有，服务器会根据用户凭证查询相对应的用户，然后把用户对象放到线程本地中，保证程序执行期间都可以访问。

在视图解析前，拦截器会把当前用户对象解析要跳转的页面中，使得可以在页面上显示用户信息。

本次请求结束后，拦截器会把线程本地的当前用户对象清除。

### 登录怎么实现的？
用户在表单输入验证码，用户名，密码，发起post登录请求。

C 接收表单传过来的数据，调用Service层判断是否正确，正确跳转到首页，并给客户端发登录凭证。失败就在原来页面原地显示错误项目。

### 验证码怎么做的
使用了Google的kaptcha来生成验证码

### 具体怎么用
1. 创建配置类
    1. 上网上搜了怎么写
2. 调用创建图片，创建文字方法直接生成。 
### 讲一下异步请求
异步请求就是在整体页面不刷新的情况下，对局部页面进行更改。

### 异步请求通过什么技术实现的呢？
通过

### 怎么优化？
#### 性能
- redis保存登录凭证
- 缓存
#### 安全
- 现在的登录凭证是保存在客户端的，不安全!!!!!。








